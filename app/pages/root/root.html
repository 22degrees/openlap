<ion-navbar *navbar>
  <button menuToggle>
    <ion-icon name="menu"></ion-icon>
  </button>
  <ion-title [ngSwitch]="rc.mode">
    <span *ngSwitchWhen="'practice'">Free Practice</span>
    <span *ngSwitchWhen="'qualifying'">Qualifying</span>
    <span *ngSwitchWhen="'race'">Race</span>
  </ion-title>
  <ion-buttons end [ngSwitch]="rc.mode">
    <span *ngSwitchWhen="'qualifying'" light>
      {{rc.time - (rc.clock | async) | time:'m:ss'}}
    </span>
    <span *ngSwitchWhen="'race'" light>
      Lap {{rc.lap}}/{{rc.laps}}
      <span *ngIf="rc.time">{{rc.time - (rc.clock | async) | time:'m:ss'}}</span>
    </span>
  </ion-buttons>
</ion-navbar>

<ion-content>
  <table class="leaderboard">
    <colgroup>
      <col width="2.25em">
      <col *ngIf="rc.mode == 'race'">
      <col>
      <col>
      <col>
      <col width="4em">
      <col width="6em" *ngIf="(cu.mode | async) != 0">
      <col width="4em">
    </colgroup>
    <thead>
      <tr>
        <th text-left>POS</th>
        <th text-left>NAME</th>
        <th *ngIf="rc.mode == 'race'" text-right>TIME</th>
        <th text-right>LAP TIME</th>
        <th text-right>BEST LAP</th>
        <th text-right>LAPS</th>
        <th text-left *ngIf="(cu.mode | async) != 0">FUEL</th>
        <th text-left></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of (rc.ranking | async); let i = index;">
        <td text-left class="stripe-container">
          {{i + 1}}<stripe [color]="item.color"></stripe>
        </td>
        <td text-left>
          {{item.driver.name}}
        </td>
        <td *ngIf="rc.mode == 'race'" [ngSwitch]="i == 0 ? null : rc.lap - item.laps" text-right>
          <span *ngSwitchWhen="">
            {{(item.time - rc.startTime) | time:'m:ss.sss'}}
          </span>
          <span *ngSwitchWhen="0">
            +{{(item.time - rc.currentTime) | time:'s.sss'}}
          </span>
          <span *ngSwitchWhen="1">
            +1 Lap
          </span>
          <span *ngSwitchDefault>
            +{{rc.lap - item.laps}} Laps
          </span>
        </td>
        <td text-right [ngClass]="{bestlap: item.laptime == item.bestlap}">
          {{item.laptime | time:'s.sss'}}
        </td>
        <td text-right>
          {{item.bestlap | time:'s.sss'}}
        </td>
        <td text-right>
          {{item.laps}}
        </td>
        <td text-left *ngIf="(cu.mode | async) != 0">
          <fuel-gauge max="15" [value]="((cu.fuel | async) || [])[item.id]"></fuel-gauge>
        </td>
        <td text-left>
          <span *ngIf="item.finished"><ion-icon name="flag"></ion-icon></span>
          <span *ngIf="((cu.pit | async) || [])[item.id]" class="pit">PIT</span>
        </td>
      </tr>
    </tbody>
  </table>
</ion-content>

<ion-toolbar position="bottom" text-center transparent>
  <startlight (click)="cu.toggleStart()" [value]="cu.start | async"></startlight>
</ion-toolbar>
